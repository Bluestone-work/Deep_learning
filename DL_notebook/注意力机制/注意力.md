## 心理学：
![image.png](https://cdn.jsdelivr.net/gh/Bluestone-work/image/image/20241002162211.png)
![image.png](https://cdn.jsdelivr.net/gh/Bluestone-work/image/image/20241002162224.png)
![image.png](https://cdn.jsdelivr.net/gh/Bluestone-work/image/image/20241002162846.png)
 ![image.png](https://cdn.jsdelivr.net/gh/Bluestone-work/image/image/20241002163202.png)
## 非参注意力池化层
![image.png](https://cdn.jsdelivr.net/gh/Bluestone-work/image/image/20241002163434.png)
![image.png](https://cdn.jsdelivr.net/gh/Bluestone-work/image/image/20241002163444.png)
![image.png](https://cdn.jsdelivr.net/gh/Bluestone-work/image/image/20241002163449.png)
K是用来衡量X和Xi之间的距离的一个函数。分子除以分母会变成一个概率，每一项就拿到了他的相对的重要性。然后用这个东西加权对yi求和。
![image.png](https://cdn.jsdelivr.net/gh/Bluestone-work/image/image/20241002164928.png)
## 参数化的注意力机制引进
![image.png](https://cdn.jsdelivr.net/gh/Bluestone-work/image/image/20241002165138.png)
## 批量矩阵乘法
![image.png](https://cdn.jsdelivr.net/gh/Bluestone-work/image/image/20241002184707.png)
![image.png](https://cdn.jsdelivr.net/gh/Bluestone-work/image/image/20241002184719.png)

### 注意力机制的工作原理

注意力机制的核心是**加权平均**，即模型根据查询（query）与键（key）的相关性，计算注意力得分，并根据这些得分对值（value）进行加权平均，以生成新的表示。注意力机制通过三种输入向量来实现：

- **Query（查询）**：当前需要进行信息提取的表示。
- **Key（键）**：每一个位置的特征或标签，用来和查询比较。
- **Value（值）**：与键对应的数据信息。

注意力机制的计算可以分为以下几个步骤：

1. **计算注意力得分（Attention Score）**：  
    对于每一个查询 qqq，它会与所有的键 kkk 进行匹配，计算出它们的相似度（相关性），通常通过点积、加性注意力或其他方法来实现。计算出来的相似度得分反映了当前查询与每个键的关联程度。
    
    - **点积注意力** (Dot-Product Attention)：查询与键通过点积计算相关性。
    - **加性注意力** (Additive Attention)：将查询与键进行线性变换后再求和、激活。
2. **归一化得分**：  
    将注意力得分通过 softmax 函数归一化为概率分布。这一步使得得分可以表示为权重，且权重的和为1。权重越高，表明该查询与某个键的相关性越大。
    
3. **加权求和值**：  
    对所有的值 vvv 进行加权求和，权重由查询与键之间的相似度得分决定，得出的结果就是当前查询的输出。这个输出整合了查询最“关注”的输入信息。
![image.png](https://cdn.jsdelivr.net/gh/Bluestone-work/image/image/20241003153144.png)

## Keysize和Qureysize
`key_size=2` 和 `query_size=20` 分别指的是 **键的维度** 和 **查询的维度**。

### 1. `key_size=2` (键的维度)

- 在注意力机制中，键（`keys`）是与查询（`queries`）进行匹配以确定相关性的元素。在你的代码中，`keys` 的形状为 `(2, 10, 2)`，其中 2 是批量大小，10 是每个小批量中的键的数量，而 **2 是每个键的维度**，这就是 `key_size=2` 的含义。
    
    所以，**key_size** 定义了每个键向量的长度。在这里，每个键向量有 2 个元素或特征。注意力机制会根据这些键与查询的相关性来计算加权和。
    

### 2. `query_size=20` (查询的维度)

- 查询（`queries`）是用于从键-值对中选择相关信息的元素。在你的代码中，`queries` 的形状为 `(2, 1, 20)`，其中 2 是批量大小，1 是每个小批量中的查询数量，而 **20 是每个查询的维度**，这就是 `query_size=20` 的含义。
    
    **query_size** 定义了每个查询向量的长度。在这里，每个查询向量有 20 个元素或特征。注意力机制会使用这些查询来寻找与之匹配的键。
    

### 3. 为什么 `key_size` 和 `query_size` 不一样？

- 在注意力机制中，查询和键通常可以具有不同的维度。虽然它们都参与相似性计算，但它们的特征空间（维度）可以不同。
- **查询的维度** 通常取决于输入序列的特征数量，或者模型希望从输入数据中提取的上下文信息的数量。
- **键的维度** 则决定了每个键在注意力计算中的特征数量。尽管查询和键维度不同，但可以通过某种方式（如线性投影或加性注意力）将它们映射到一个共同的空间，以计算相似性。

### 小结：

- `key_size=2`：每个键向量有 2 个特征。
- `query_size=20`：每个查询向量有 20 个特征。

在加性注意力中，查询和键的维度可能会通过一些变换被组合在一起，通过一个隐藏层（比如 `num_hiddens=8` 指定的隐藏层大小）计算相似度，从而得到注意力权重。

### 1. **Query (查询)**

**Query（查询）** 可以被理解为我们提出的一个问题，模型需要根据这个问题去找出最相关的信息。例如：

- 假设你在搜索引擎中输入一个搜索词，这个词就是查询（Query）。搜索引擎会根据这个查询从庞大的数据库中找到最相关的网页。

在注意力机制中，**查询** 是一个向量，它代表当前正在处理的输入数据的某一部分。比如在机器翻译中，Query 通常代表当前要翻译的词或者句子片段。

### 2. **Key (键)**

**Key（键）** 可以被类比为数据中的“索引”或“标签”，帮助模型根据查询找到相关的信息。在我们的搜索引擎比喻中，数据库中的每个网页都会有一些与之关联的标签或特征，这些特征就类似于 **Key**。

- 当搜索引擎收到查询时，它会去对比数据库中网页的这些标签（Key），看哪些与查询最匹配，哪些网页最相关。

在注意力机制中，**Key** 是另一个向量，它与查询向量一起参与计算，用来衡量某个输入数据片段是否与查询相关。

### 3. **Value (值)**

**Value（值）** 是与 **Key** 相关联的数据。当我们找到一个与查询相关的 Key 时，我们取出的实际信息就是 Value。在搜索引擎比喻中，**Value** 就是搜索结果的网页内容。你输入查询，搜索引擎找到匹配的 Key，然后返回与你查询相关的网页（Value）。

在注意力机制中，**Value** 是与每个 Key 相关联的向量，它是模型根据注意力权重加权后最终要返回的输出。

### 4. **为什么叫注意力机制？**

**注意力机制** 之所以这样命名，是因为它让模型能够根据输入数据的重要性来“有选择地关注”某些部分。这个过程类似于我们在阅读文章时，可能会对某些词或句子给予更多关注，而跳过不重要的部分。

模型通过计算 **查询（Query）** 和 **键（Key）** 的相似度（比如通过点积或加法操作）来决定应该关注哪些值。然后，它会根据这些相似度分数（权重）对 **值（Value）** 进行加权，从而输出一个加权求和的结果。

具体来说：

- 查询和键的相似度得分决定了模型需要对每个值的关注程度。如果查询和某个键的相似度很高，表示这个键-值对与查询高度相关，模型就会更加关注这个值。
- 这种机制有效地让模型集中关注那些最能提供信息的部分，而不是简单地处理所有输入数据。

### 5. 一个简单的例子：

假设我们正在翻译一句话：“The cat is on the mat”，当前模型正在翻译 “on” 这个词。

- **Query（查询）**：模型会生成一个与“on”这个词相关的查询向量，它表示模型希望找到句子中与“on”相关的信息。
    
- **Key（键）**：句子中的每个单词都会生成一个键向量，表示它在句子中的某种特征。
    
- **Value（值）**：每个单词还会生成一个值向量，它包含这个单词的具体信息。
    
    然后，模型会计算“on”这个查询向量与其他单词的键向量的相似性，发现“mat”与“on”最相关，因此模型会更加关注“mat”的值向量，并用这个信息来生成正确的翻译。
    

### 6. 总结

- **Query（查询）**：表示模型当前处理的输入，它提出了“我现在要关注什么”的问题。
- **Key（键）**：表示输入数据的特征，用于与查询进行匹配，帮助找到与查询相关的数据。
- **Value（值）**：是与键关联的数据，表示输入中的实际内容，模型最终输出的就是经过加权后的值。